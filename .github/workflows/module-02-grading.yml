name: Module 02 - Frontend Docker Grading

on:
  push:
    paths:
      - 'assignments/module-02-dockerize-frontend/**'
      - 'frontend/**'
  pull_request:
    paths:
      - 'assignments/module-02-dockerize-frontend/**'

jobs:
  grade-module-02:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Validate Dockerfile exists
        run: |
          if [ ! -f "assignments/module-02-dockerize-frontend/starter/Dockerfile" ]; then
            echo "Dockerfile not found"
            exit 1
          fi

      - name: Build Docker image
        working-directory: assignments/module-02-dockerize-frontend/starter
        run: docker build -t frontend-test .

      - name: Run container
        run: |
          docker run -d --name frontend-test -p 8080:80 frontend-test
          sleep 5

      - name: Test HTTP response
        run: |
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/)
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "Frontend accessible - 200 OK"
          else
            echo "Frontend returned $HTTP_CODE"
            exit 1
          fi

      - name: Cleanup
        if: always()
        run: |
          docker stop frontend-test || true
          docker rm frontend-test || true

      - name: Summary
        if: success()
        run: |
          echo "Module 02 Grading: PASSED - 10/10 points"
